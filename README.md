# 🎮 GAME STREAM DJ

配信者向け高機能BGM管理ツール v3.3

## 🚀 起動方法

1. **`start.bat`** をダブルクリック
2. ブラウザで `http://127.0.0.1:8000` を開く

---

## 🎛️ 機能一覧

### デッキ操作 (Deck A / B)
| 機能 | 説明 |
|------|------|
| **Load** | YouTube URLを入力欄に貼り付け、「Load」ボタンで再生開始 |
| **再生/一時停止** | ▶ボタン、または **スペースキー** でアクティブなデッキを操作 |
| **シークバー** | ドラッグで再生位置を変更 |
| **ボリューム** | 各デッキの音量を調整 |
| **Add to Lib** | 現在再生中の曲をライブラリに追加 |

### ミキサー (中央パネル)
| 機能 | 説明 |
|------|------|
| **SWITCH DECK** | アクティブなデッキを切り替え（クロスフェード付き） |
| **クロスフェーダー** | A ↔ B の音量バランスを手動調整 |
| **タイマー** | 指定した時間（分）後に自動でデッキ切り替え |
| **Mode A→B / B→A** | 切り替え時の挙動を設定 (Resume / Restart / Next Queue) |
| **Switch Key** | グローバルホットキーを設定 (例: F8) |

### ライブラリ & キュー管理 (画面下部)
| 領域 | 説明 |
|------|------|
| **Queue A** | Deck A で再生予定の曲リスト |
| **LIBRARY** | お気に入り曲のマスターリスト。ここから A/B の Queue にコピー可能 |
| **Queue B** | Deck B で再生予定の曲リスト |

- **曲名編集**: リスト内の曲名をクリックして直接編集
- **削除**: × ボタンで削除（ライブラリは確認ダイアログ表示）
- **キューへ追加**: ライブラリ内の [A] [B] ボタンで各キューへ

### Deck B 専用: スマートループ
| 機能 | 説明 |
|------|------|
| **Loop Start / End** | ループ区間（秒）を手動設定 |
| **Analyze** | URLから自動的にループポイントを検出 (*要: yt-dlp + JS Runtime) |
| **Test** | ループ境界を確認（指定秒数前からプレビュー再生） |
| **Dual Ping-Pong** | 2つの仮想プレイヤーで読み込みラグなしの無限ループを実現 |

### 便利機能
| 機能 | 説明 |
|------|------|
| **Clipboard Sync** | `Auto-Add Clip to:` を有効にすると、YouTube URLをコピーするだけで自動登録 |
| **グローバルホットキー** | 他のウィンドウがアクティブでも `F8` などでデッキ切り替え可能 |
| **スペースキー** | アクティブなデッキの再生/一時停止 |
| **Save All** | 手動で現在の状態を保存（通常は自動保存） |

---

## ⌨️ キーボードショートカット

| キー | 動作 |
|------|------|
| **Space** | アクティブデッキの再生/一時停止 |
| **F8** (カスタマイズ可) | デッキ切り替え（グローバルホットキー） |

---

## ⚠️ 注意事項

### 自動ループ解析 (Analyze) について
YouTube の仕様変更により、ループ解析機能の動作に制限があります。
解決策として以下を試してください:

1. **yt-dlp を最新版に更新**:
   ```
   pip install -U yt-dlp
   ```
2. **JavaScript Runtime (deno) をインストール**:
   - https://deno.com/
   - または Node.js でも動作する場合あり

うまくいかない場合は、手動でループポイントを設定してください。

---

## 💾 データ保存場所 (バックアップ)

- **設定・ライブラリ・キュー**: `backend/dj_state.json`
  - すべての設定、登録した曲、再生キューがこのファイルに保存されます。
  - 定期的にコピーしてバックアップを推奨します。

---

## 動作要件
- Windows 10/11
- Python 3.10+
- (オプション) deno または Node.js (自動ループ解析用)
