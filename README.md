# 🎮 自作GAME STREAM DJ v1.1.1-beta

配信者向け高機能BGM管理ツール。YouTube音源を2つのデッキでシームレスにコントロールし、配信に最適な演出を提供します。

## 🚀 起動方法

1. **`start.bat`** をダブルクリック
2. ブラウザで `http://127.0.0.1:8000` を開く

## v1.1.1-beta (Current) - 2026-02-15

### 機能改善・修正
- [x] **D&D中スクロール**: アイテムドラッグ中もマウスホイールでのリストスクロールが可能に
- [x] **OBS接続ステータス**: Settings画面に「Connected / Disconnected」のバッジを表示
- [x] **OBS双方向連動**: OBS側でシーンを変更した場合も、対応するデッキへ自動で切り替わる機能を追加
- [x] **UI改善**: Scene A/B設定欄に、どちらのデッキと連動するかの説明を追加

---

## v1.1.0-beta - 2026-02-15

## 🎛️ 機能一覧

### デッキ操作 (Deck A / B)
| 機能 | 説明 |
|------|------|
| **Load** | YouTube URLを入力、「Load」で再生開始。 |
| **再生/一時停止** | ▶ボタン、または **スペースキー** でアクティブなデッキを操作。 |
| **シークバー** | ドラッグで再生位置を変更。 |
| **ボリューム** | 各デッキの音量を個別に調整。 |
| **Add to Lib** | 現在の曲をライブラリに追加。 |

### ミキサー & 設定 (中央パネル & Switch Triggers)
| 機能 | 説明 |
|------|------|
| **SWITCH DECK** | アクティブなデッキを切り替え（クロスフェード付き）。 |
| **Switch Triggers (⚙️)** | A→B / B→A 個別のタイマー、OBS連携、フェード秒数、ホットキーを管理。 |
| **クロスフェーダー** | A ↔ B の音量バランスを手動調整。 |
| **Mode A→B / B→A** | 切り替え時の挙動をボタンで選択 (Resume / Restart / Next)。 |
| **Queue Mode** | 🔀/🔢 ボタンで、次の曲を順番通りにするか、シャッフルするか切替。 |

### ライブラリ & キュー管理 (画面下部)
| 領域 | 説明 |
|------|------|
| **Queue A / B** | 各デッキで次に再生される曲のリスト。ドラッグ＆ドロップで並べ替え可能。サムネイル付き。 |
| **LIBRARY** | お気に入り曲のマスターリスト。ここから各キューへ楽曲を追加できます。 |

- **ドラッグ＆ドロップ**: 並べ替え時に**青いプレースホルダ**が表示されます。端へドラッグすると自動スクロールします。
- **曲名編集**: リスト内の曲名をダブルクリックして直接編集可能。

### Deck B 専用: スマートループ
| 機能 | 説明 |
|------|------|
| **Loop Start / End** | ループ区間（秒）を手動設定 |
| **Analyze** | URLから自動的にループポイントを検出 (*要: yt-dlp + JS Runtime) |
| **Test** | ループ境界を確認（指定秒数前からプレビュー再生） |
| **Dual Ping-Pong** | 2つの仮想プレイヤーで読み込みラグなしの無限ループを実現 |

### 便利機能
| 機能 | 説明 |
|------|------|
| **Clipboard Sync** | `クリップボード自動追加` を有効にすると、YouTube URLをコピーするだけで自動登録 |
---

## 🎥 OBS Sync (自動シーン切り替え)

デッキの切り替えに連動して、OBS のシーンを自動で変更できます。

### セットアップ手順
1.  **OBS側の設定**:
    - [ツール] -> [WebSocket サーバー設定] を開く。
    - [WebSocket サーバーを有効にする] をチェック。
    - **サーバーポート** (`4455`) と **サーバーパスワード** を確認・メモします。
2.  **本ツール側の設定**:
    - ブラウザで **Switch Triggers (⚙️)** を開く。
    - **OBS接続設定** セクションに、Host / Port / Password を入力。
    - **「接続テスト」** ボタンを押して接続確認。ステータスが `Connected` になればOK。
    - **Scene A / Scene B** に、OBSで作成したシーン名を正確に入力（例: `BGM_A`, `BGM_B`）。
3.  **A→B / B→A 切り替え設定**:
    - 各方向のセクションで **「OBS連動」** をチェックします。
4.  **動作**:
    - **アプリ → OBS**: `SWITCH DECK` を行うと、チェックが入っている方向の切り替え時に指定シーンへ瞬時に切り替わります。
    - **OBS → アプリ**: OBS側で指定シーン（Scene A / B）に切り替えると、自動的に対応するデッキへ切り替わります（双方向連動）。

> **Note**: `.env` ファイルは不要です。全てブラウザのSettings画面から設定・保存できます。

---

## ⌨️ キーボードショートカット

| キー | 動作 |
|------|------|
| **Space** | アクティブなデッキの再生/一時停止 |
| **Switch Key** | デッキ切り替え（Switch Triggersで任意のキーを設定可能。グローバル対応）。`F8`がデフォルト。 |
| **Ctrl + Z** | 直前のライブラリ操作などの取り消し (Undo) |

> **重要**: ブラウザの制限により、**このアプリのタブがアクティブでない（別タブを見ている）場合、キーを押しても反応が遅延します**。
> タブに戻った瞬間に切り替えが実行されます。
> 別ウィンドウとして切り離して表示している場合や、アプリのウィンドウがアクティブな場合は、他のアプリ操作中でも即座に反応します。

---

## ⚠️ 注意事項・ヒント

- **自動ループ解析 (Analyze)**: YouTubeの仕様変更により失敗する場合は、`pip install -U yt-dlp` で最新版に更新してください。
- **データ保存**: 設定やライブラリは `backend/dj_state.json` に自動保存されます。バックアップはこのファイルをコピーしてください。
- **Node.js**: PCに Node.js がインストールされていると、解析の精度と速度が向上します。
- **F8ホットキー**: ブラウザがバックグラウンド（非表示タブ）の場合、ブラウザの仕様によりタブを表示した瞬間に切り替えが実行されます。

---
Developed by Antigravity
